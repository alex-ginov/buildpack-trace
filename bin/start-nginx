#!/bin/bash
set -e

# Vérifier que erb est disponible
if ! command -v erb &> /dev/null; then
    echo "ERREUR: erb n'est pas installé. Installation en cours..."
    apt-get update && apt-get install -y ruby-erb || {
        echo "Échec de l'installation de erb"
        exit 1
    }
fi

APP_DIR="/app"
NGINX_CONF="${APP_DIR}/config/nginx.conf.erb"

# Générer la configuration Nginx
echo "-----> Génération de la configuration Nginx"
erb $NGINX_CONF > /tmp/nginx.conf

# Démarrer Nginx
echo "-----> Démarrage de Nginx"
exec nginx -c /tmp/nginx.conf -g "daemon off;"